========  TOTEST ===============
? strip() for adjustments
* add sonymts patterns
# --dry_run, --dry

========  TODO ===============

**!!! UNABLE TO CONVERT AUDIO FROM SRC -- MAYBE __dga will help

[Error] Log for job0023 (audio, 00021_22.mts -> 00021_22.mts.tmp.mp4)
-[Information] [30.04.2015 17:31:41] Started handling job
-[Information] [30.04.2015 17:31:41] Preprocessing
-[Information] [30.04.2015 17:31:41] MediaInfo
--[Information] [30.04.2015 17:31:41] File: C:\Documents and Settings\taranenko\YandexDisk\to_copy\00021_22.mts
--[Information] General
---[Information] Format: MPEG-TS
---[Information] FormatString: MPEG-TS
---[Information] FileSize: 246419496
---[Information] PlayTime: 00:01:12.497
--[Information] Video
---[Information] ID: 256
---[Information] StreamOrder: 0-0
---[Information] Width: 1920
---[Information] Height: 1080
---[Information] FrameCount: 4346
---[Information] FrameRate: 59.940
---[Information] FrameRateOriginal: 
---[Information] FrameRateMode: 
---[Information] ScanType: Progressive
---[Information] Codec: AVC
---[Information] CodecString: AVC
---[Information] Bits Depth: 8
---[Information] Format: AVC
---[Information] AspectRatio: 1.778
---[Information] AspectRatioString: 16:9
---[Information] Delay: 20.678
---[Information] Title: 
---[Information] Language: 
---[Information] LanguageString: 
---[Information] Default: 
---[Information] DefaultString: 
---[Information] Forced: 
---[Information] ForcedString: 
--[Information] Audio
---[Information] ID: 257
---[Information] StreamOrder: 0-1
---[Information] Format: AC-3
---[Information] FormatProfile: 
---[Information] FormatSettingsSBR: 
---[Information] FormatSettingsPS: 
---[Information] SamplingRate: 48000
---[Information] SamplingRateString: 48.0 KHz
---[Information] Channels: 2
---[Information] ChannelsString: 2 channels
---[Information] ChannelPositionsString2: 2/0/0
---[Information] BitRateMode: CBR
---[Information] Delay: 468.678
---[Information] Title: 
---[Information] Language: 
---[Information] LanguageString: 
---[Information] Default: 
---[Information] DefaultString: 
---[Information] Forced: 
---[Information] ForcedString: 
-[Information] [30.04.2015 17:31:42] Trying to open the file with NicAudio
-[Information] [30.04.2015 17:31:42] Failed opening the file with NicAudio()
-[Information] [30.04.2015 17:31:42] Trying to open the file with BassAudioSource()
-[Information] [30.04.2015 17:31:42] Failed opening the file with BassAudioSource(). bassAudioSource: File could not be opened!
-[Information] [30.04.2015 17:31:42] Trying to open the file with FFAudioSource()
-[Information] [30.04.2015 17:31:42] Successfully opened the file with FFAudioSource()
-[Information] [30.04.2015 17:31:43] Avisynth script
--[NoImage] ClearAutoloadDirs()
--[NoImage] AddAutoloadDir("C:\MY\MeGUI_2525_x86\tools\avs\plugins")
--[NoImage] LoadPlugin("C:\MY\MeGUI_2525_x86\tools\ffms\ffms2.dll")
--[NoImage] FFAudioSource("C:\Documents and Settings\taranenko\YandexDisk\to_copy\00021_22.mts")
--[NoImage] # detected channels: 2 channels
--[NoImage] # detected channel positions: 2/0/0
--[NoImage] return last
-[Information] [30.04.2015 17:31:43] Commandline used: -ignorelength -br 125000 -if - -of "{0}"
-[Information] [30.04.2015 17:31:43] Avisynth script environment opened
-[Information] [30.04.2015 17:31:43] Script loaded
-[Information] [30.04.2015 17:31:43] Output Decoder
--[Information] [30.04.2015 17:31:43] Channels: 2
--[Information] [30.04.2015 17:31:43] Bits per sample: 32
--[Information] [30.04.2015 17:31:43] Sample rate: 48000
-[Information] [30.04.2015 17:31:43] Job commandline: C:\MY\MeGUI_2525_x86\tools\eac3to\neroAacEnc.exe -ignorelength -br 125000 -if - -of "C:\Documents and Settings\taranenko\YandexDisk\to_copy\00021_22.mts.tmp.mp4"
-[Information] [30.04.2015 17:31:43] Process started
-[Information] [30.04.2015 17:31:43] Standard output stream
-[Information] [30.04.2015 17:31:43] Standard error stream
-[Error] [30.04.2015 17:31:47] An error occurred: FFAudioSource: Seeking is severely broken
-[Information] [30.04.2015 17:31:47] Job completed


:

* process path/to/files/grep_pattern

* move configs to "./cfg", log and cache to "./log" [?]
					+ store log of command string (unique only? or maybe with timestamp)
* write not "enforced encoding as" but "..with" if +pattern
* AVS_SUFFIX (both to AVS creation and to output) - several output
* not just skip AVS creation if exists - but if it different - skip whole job [or ask?]
  + at least do not say about skipping (only to log - that content is the same)

*  parse videobrate / ({<float}, {>float}, {>=float, <=float},
*  better pattern config parsing (re.compile("^[A-Za-z_:0-9] *@?[=>]")
*  alternate pattern description syntax ( NAME @=> name=val1|name2>=val2,name2<=val2_1 )
			name equality value	( equalities: =, ==(float), ~=(insensetive), !=, <>(float), <, >, <=, >= )

## ALTERNATE SYNTAX: TODO
#sony:720  ==> width=1440|height=1080|fps==50|v_brate>11|vcodec=AVC|vprofile=Main@L4.0|vscan_type=Progressive


* SKIP_EXISTED -- detect by <Output> target mux job - scan joblists 
# ADJUSTMENT{name} -- extra adjustment
* make_boolask (-1,False,True)	{ -1= <0, '?', 'ask'}


* RESOLVE
* If template starts from '!' - than in case conflict if no other '!' templates found - use this 
	(or even better -- ENCODINGSECTION NAMES COULD STARTS FROM [priority]" )

* show list of available tasks and extra_avs if no source given
* if token name starts from {!}  - case insensetive comparision (WHAT'S FOR? DETECT?)
* CRF encoding

* --SHOW_SCAN (make output for scaned )
* tool:
	- detector	
	- config modifier

	tool.py srcvideofile file1 file2 ...
	or tool.py srcvideofile avsfile jobname1 jobname2 ...
		-- asks detect pattern name (check name collision - propose suffix) 
			--> used to make templates names ( pname.avs, pname_a, pname_v, pname_idx, pname_mux )
		-- auto determine full name to videofile (to detect @SRCPATH@, @BASEPATH@)
		-- asks BITRATE/CRF (variable information exists? @BITRATE@=, then enter your own in format @KEY@=num)
		-- if file is xml -- ask what kind of job(maybe get from xml==> <Job xsi:type="AudioJob">), what is the desired pattern name
		   if file is not xml - means .avs (only one such one)
		-- add xmls, add detect pattern, add encoding pattern
		-- try to detect - if any existed detect pattern matched - warn about it (prevent futher collisions)
		-- try to make template alias instead of copy xml (if mostly equal, same number of pass, no delete
		-- enter essential variable info (CRF, bitrate)
		-- maybe even don't need to give file list - just find last correspondance(?). going thru joblist, find requirements and links (input-output, required_job, ..)
		   or maybe give only one related job
		* write to !extra.cfg file


========  DONE ===============

* Usage: convertor.py [--debug] [--strict] [--key1=value1] [--key2==value2] [...] DIRECTORY_OR_FILE_TO_PROCESS1 [DIRECTORY_OR_FILE_TO_PROCESS2 [..]]

* multiple matches to same pattern(for detect) [suffix to make several conditions list matched to same pattern name?]
* custom_func.py.cfg - setter and getter
* FIX: correct processing of --@OPT@=val and @name@ in .cfg
* Correctly processed even if no .cfg file defined and for minimal cfg

* _add_elem for mkvmux{DAR:X1:X2=smth} is not pretty print
  --> because X1 will be last elem of DAR and so X1.tail=upper_hierarchy_ident

*ENCODE{smth}, DETECT{smth}
* if given ENCODE{}, DETECT{} is empty - remove it from list (for TASK/OPTION sections)

* IMPORTANT: adj - have to be OrderedDict because order of list could have a sense
* [TEMPLATES]/cfg.TEMPLATE{name}

adjustment -- give path in XML to fix (  DAR:AR=@{RATIO}@|DAR:X=@{AR_X}@|DAR:Y=@{AR_Y}@ )
					{DAR:AR=@{RATIO}@,+DAR:X:X1=@{AR_X}@,DAR:Y=@{AR_Y}@}
           -- can have += (token values could starts from +) EXTRA_AVS=+smth
           -- if starts from ? -- means do not add if not existent
                             + -- add a new one anyway (FilesDelete:string for example)

* 2_3 phase, adjustments(raw, path:tag:name, flags(+?)); 
* if TASK with such name not exists, but exists EXTRA_AVS - add it
* use cfg.STRICT in parsing (so if place it in beginning of cfg it will affect)


	x264avchd  = x264base{ ?KeyframeInterval=60, ?NbBframes=5, ?NoFastPSkip}
	+     <KeyframeInterval>60</KeyframeInterval>
	+     <NbBframes>5</NbBframes>
	+     <NoFastPSkip>true</NoFastPSkip>
	+     <NbRefFrames>7</NbRefFrames>
	+     <IPFactor>1.3</IPFactor>
	+     <PBFactor>1.4</PBFactor>
	+     <BframeBias>50</BframeBias>
	+     <x264BFramePyramid>2</x264BFramePyramid>
	+     <Level>14</Level>


[CANCEL] cached config(using pickle?) -- for performance. looks like it fast enough anyway


